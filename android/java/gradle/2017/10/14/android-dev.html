<!DOCTYPE html>
<html>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Android Development from the Command Line</title>
  <meta name="description" content="Do you like your development tools to be as simple as a text editor to write the code and a bunch of CLI application to build your projects? Do you feel like...">
  <meta name="theme-color" content="#100808" />

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="https://p403n1x87.github.io//android/java/gradle/2017/10/14/android-dev.html">
  <link rel="alternate" type="application/rss+xml" title="The Hub of Heliopolis" href="https://p403n1x87.github.io//feed.xml">
</head>


  <body>

    <header class="site-header">
  <div class="site-title">
    ~# <a href="/">the-<strong>hub</strong>-of-heliopolis</a><span class="blinking-cursor">&block;</span>
  </div>
  <div class="wrapper">
    <nav class="site-nav">
      <div class="trigger">
        
          
        
          
          <a class="page-link" href="/">Posts</a>
          
        
          
        
          
          <a class="page-link" href="/about/">About</a>
          
        
      </div>
    </nav>

  </div>
</header>


    <div class="page-content">
      <div class="wrapper">
        <h1 class="post-title" itemprop="name headline">Android Development from the Command Line</h1>

<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header class="sidepane post-header">
    
    <div class="post-info">
  <div class="post-detail"><i class="fa fa-calendar-plus-o" aria-hidden="true"></i>&nbsp;2017 Oct 14</div>
  <div class="post-detail"><i class="fa fa-clock-o" aria-hidden="true"></i>&nbsp;<span class="reading-time" title="Estimated read time">
  
  
    a 34 minute read
  
</span>
</div>
  <div class="flex-container flex-row post-detail">
  <div><i class="fa fa-archive" aria-hidden="true"></i></div>&nbsp;
  <div><span class="category">Android</span><span class="category">Java</span><span class="category">Gradle</span></div>
</div>
<div class="flex-container flex-row post-detail">
  <div><i class="fa fa-tags" aria-hidden="true"></i></div>&nbsp;
  <div class="flex-container flex-row flex-wrap"><span class="tag">Programming</span><span class="tag">Java</span><span class="tag">Android</span><span class="tag">Gradle</span><span class="tag">Lint</span></div>
</div>

  
    <div class="post-detail"><i class="fa fa-github" aria-hidden="true"></i>&nbsp;<a href="https://github.com/P403n1x87/androtest">P403n1x87/androtest</a></div>
  
</div>


    <div class="toc">
      <div class="heading">Table of Contents</div>
      <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#introduction">Introduction</a></li>
<li class="toc-entry toc-h1"><a href="#pre-requisites">Pre-requisites</a>
<ul>
<li class="toc-entry toc-h2"><a href="#android-sdk-tools">Android SDK Tools</a></li>
<li class="toc-entry toc-h2"><a href="#android-sdk-platform-tools">Android SDK Platform Tools</a></li>
<li class="toc-entry toc-h2"><a href="#android-sdk-platforms">Android SDK Platforms</a></li>
<li class="toc-entry toc-h2"><a href="#android-sdk-build-tools">Android SDK Build Tools</a></li>
<li class="toc-entry toc-h2"><a href="#android-emulator">Android Emulator</a></li>
<li class="toc-entry toc-h2"><a href="#gradle">Gradle</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#creating-the-gradle-project">Creating the Gradle Project</a></li>
<li class="toc-entry toc-h1"><a href="#writing-the-application">Writing the Application</a>
<ul>
<li class="toc-entry toc-h2"><a href="#the-application-manifest">The Application Manifest</a></li>
<li class="toc-entry toc-h2"><a href="#the-main-activity">The Main Activity</a></li>
<li class="toc-entry toc-h2"><a href="#the-layout-resource">The Layout Resource</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#running-the-application">Running the Application</a>
<ul>
<li class="toc-entry toc-h2"><a href="#building-with-gradle">Building with Gradle</a></li>
<li class="toc-entry toc-h2"><a href="#creating-a-virtual-device">Creating a Virtual Device</a></li>
<li class="toc-entry toc-h2"><a href="#installing-the-apk">Installing the APK</a></li>
<li class="toc-entry toc-h2"><a href="#the-lint-tasks">The lint tasks</a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#conclusions">Conclusions</a></li>
</ul>
    </div>

  </header>

  <div class="post-text">

    <div class="post-excerpt">
      <p>Do you like your development tools to be as simple as a text editor to write the code and a bunch of CLI application to build your projects? Do you feel like you are in a cage when you use an IDE? Or perhaps your PC or laptop is a bit dated and all the cores spin like crazy when you fire up Android Studio? Then read on to learn how you can develop Android application with just the text editor of your choice and the standard Android SDK CLI tools.</p>

    </div>

    <div class="post-content" itemprop="articleBody">
      <h1 id="introduction">
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h1>

<p>Yes you guessed it right, I’m not a huge fan of IDEs. Don’t get me wrong though, I am fully aware of how powerful modern IDEs are, and all the magic that they can do for you to assist you while you are coding your application. But this is also why I don’t like them, especially when I’m picking up something new.</p>

<p>To the date of writing, I am not an experienced Android developer. When I started developing applications (there was a time when I believed that no matter how big a project could be, you could always find the time to code it in assembly language), a plain old text editor was my friend, together with some command line tools, like assemblers, linkers, compilers, debuggers etc…. With no support at all, you had to know exactly what you were doing, you had to know the syntax, the APIs and where they were located. You also needed a minimum knowledge of what a linker is for and when and why you need one.</p>

<p>Whenever I tried an IDE, e.g. Android Studio, I always felt like I didn’t really need to know much about the frameworks I was using, as all the built-in tools would come to my rescue. As a consequence, I started feeling like I wasn’t really mastering anything and put the project I was working on aside for future me to one day resume working on it. Rather than me using the IDE, it kind of was the other way around: the IDE was using me to magically generate code.</p>

<p>IDEs also tend to hide all the machinery involved in the build process from the developer as well. In most cases, everything goes well, but what would you do if you suddenly come across a problem and you have no clue at which stage of the build process it is happening?</p>

<p>Surely, if you work on a big company project, it would be crazy to renounce entirely to IDEs, as your life might be a bit harder in everyday maintenance of your code, but for smaller projects this argument is somewhat weak, and opting for a plain text editor might have its many advantages. For once, you are in total control of the code that is going into your final product. And then again, there is also the educational aspect, which can give you the right amount of experience to tackle unexpected issues that could pop up during any stage of the development life-cycle.</p>

<p>All this being said, in this post we shall see how to develop an Android application by only relying on a text editor of your choice and the standard CLI tool provided by the Android SDK. The focus is on the steps required to install the Android SDK command line tools and how to organise your source code, rather than on the details of the application itself.</p>

<p>As with a standard Android project created with Android Studio, we are going to rely on Gradle and the Android Gradle plugin for the build process. You may rightfully think that this somehow partly defeats the point of this post, but, hey, in the end Gradle is just a command line tool, and quite a standard way to build and deploy Java projects these days.</p>

<p>This post is targeted to Linux users, but there is a good chance that the steps that we will go through have an equivalent on other platforms, like Windows. I’m afraid this is something that you will have to find out on your own.</p>

<p>Code very similar to the one presented in this post can be found in the GitHub repository <a href="https://www.github.com/P403n1x87/androtest">androtest</a>.</p>

<h1 id="pre-requisites">
<a id="pre-requisites" class="anchor" href="#pre-requisites" aria-hidden="true"><span class="octicon octicon-link"></span></a>Pre-requisites</h1>

<p>Before embarking on an adventure, it is wise to check that we are taking all that we need along the way with us. As we are trying to keep things as simple as possible, we won’t need much, but there are a few preliminary steps that we need to perform in order to set up our development environment.</p>

<p>The first few steps couldn’t be simpler: pick your favourite text editor (my laptop can still handle an application like Atom) and terminal application, and we already have almost half of what we need! The rest of the tools is provided by the Java Development Kit, the Android SDK Tools and Gradle. More details in due time.</p>

<p>The JDK is usually available from your distro’s repositories. On Ubuntu, it can be installed with, e.g.</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ </pre></div>
<div><pre>
sudo apt install openjdk-9-jdk
</pre></div>
</div></div>

<p>The Android SDK might not be available from the official repositories. In principle the could be installed along with Android Studio, but if you are not going to use Google’s official IDE then it is a bit of waste of space. The <em>cleaner</em> alternative is to just download the Android SDK Tools from the <a href="https://developer.android.com/studio/index.html#command-tools">Android Studio</a> download page. For simplicity, I will split the installation process of the Android SDK into different steps.</p>

<h2 id="android-sdk-tools">
<a id="android-sdk-tools" class="anchor" href="#android-sdk-tools" aria-hidden="true"><span class="octicon octicon-link"></span></a>Android SDK Tools</h2>

<p>Download the zip archive and extract it somewhere, e.g. <code class="highlighter-rouge">~/.android/sdk</code>, then update your <code class="highlighter-rouge">.bashrc</code> file to define the <code class="highlighter-rouge">ANDROID_HOME</code> environment variable and include the SDK tools binaries in the <code class="highlighter-rouge">PATH</code> variable by adding the following lines</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># Android SDK Tools</span>
<span class="nb">export </span><span class="nv">ANDROID_HOME</span><span class="o">=</span><span class="nv">$HOME</span>/.android/sdk
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$ANDROID_HOME</span>/tools:<span class="nv">$ANDROID_HOME</span>/tools/bin</code></pre></figure>

<p>Note that most of the tools installed in <code class="highlighter-rouge">$ANDROID_HOME/tools</code> are deprecated and one should use the dedicated ones provided in the <code class="highlighter-rouge">$ANDROID_HOME/tools/bin</code> folder. These include the fundamental <a href="https://developer.android.com/studio/command-line/sdkmanager.html"><code class="highlighter-rouge">sdkmanager</code></a> and the <a href="https://developer.android.com/studio/command-line/avdmanager.html"><code class="highlighter-rouge">avdmanager</code></a> tools for respectively creating and managing different SDK versions (and other packages too) and virtual devices (the emulators).</p>

<h2 id="android-sdk-platform-tools">
<a id="android-sdk-platform-tools" class="anchor" href="#android-sdk-platform-tools" aria-hidden="true"><span class="octicon octicon-link"></span></a>Android SDK Platform Tools</h2>

<p>Throughout the Android development life-cycle, you are likely to need to interface with the Android platform for testing your progress. In concrete terms this means that you might want to compile your project as you develop it for testing on an actual Android device. In order to connect to the device and look at the log you will need the Android Debug Bridge, which is provided with the Android Platform Tools. To install them we can use the <code class="highlighter-rouge">sdkmanager</code> CLI tool to pull the latest released version with the following command</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ </pre></div>
<div><pre>
sdkmanager "platform-tools"
</pre></div>
</div></div>

<p>This will install the Platform Tools into the <code class="highlighter-rouge">$ANDROID_HOME/platform-tools</code> folder. We can then add it to the <code class="highlighter-rouge">PATH</code> variable for easy invocation by simply adding the following lines to <code class="highlighter-rouge">.bashrc</code></p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># Android Platform Tools</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$ANDROID_HOME</span>/platform-tools</code></pre></figure>

<h2 id="android-sdk-platforms">
<a id="android-sdk-platforms" class="anchor" href="#android-sdk-platforms" aria-hidden="true"><span class="octicon octicon-link"></span></a>Android SDK Platforms</h2>

<p>In order to compile a project we need a certain API revision to be installed. This provides all the functionalities that our application can use and are provided in the form of Java packages and classes and other useful components. For example, if our project targets Marshmallow, then we need to install the Android SDK Platform API Level 23. You can find out more at <a href="https://developer.android.com/guide/topics/manifest/uses-sdk-element.html#ApiLevels">this page</a>. To find out about all the packages available to download we can use the command</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ </pre></div>
<div><pre>
sdkmanager --list --verbose
</pre></div>
</div></div>

<p>At the moment we are interested in Android platforms, i.e. those packages that are prefixed with <code class="highlighter-rouge">platforms;</code>, so we can filter the output of the above command as follows</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ </pre></div>
<div><pre>
sdkmanager --list --verbose | grep -A 3 platforms\;
</pre></div>
</div></div>

<p>Among the matching results, you should see something similar to the following</p>

<div class="terminal"><div class="terminal-body flex-container flex-row"><div><pre>
platforms;android-23
    Description:        Android SDK Platform 23
    Version:            3
</pre></div></div></div>

<p>We can then proceed to installing the Android SDK Platform API Level 23 with the command</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ </pre></div>
<div><pre>
sdkmanager "platforms;android-23"
</pre></div>
</div></div>

<blockquote>
  <p>When you use the <code class="highlighter-rouge">sdkmanager</code> tool, you might see the following warning message</p>

  <p><code class="highlighter-rouge">Warning: File /home/user/.android/repositories.cfg could not be loaded.</code></p>

  <p>In order to get rid of it you can simply create this file with no content.</p>
</blockquote>

<h2 id="android-sdk-build-tools">
<a id="android-sdk-build-tools" class="anchor" href="#android-sdk-build-tools" aria-hidden="true"><span class="octicon octicon-link"></span></a>Android SDK Build Tools</h2>

<p>Now that we have the API to compile against, we need the tools to actually be able to build a project: the build tools. They provide utilities like <code class="highlighter-rouge">apksigner</code>, Jack and Jill etc…, but for the moment we don’t have to worry about the details of this package, as they will be invoked behind the scenes by Gradle.</p>

<p>The <a href="https://developer.android.com/studio/releases/build-tools.html">Android Studio User Guide</a> recommends that you keep the build tools updated to the latest version. To find out all the versions available for download, run the following command</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ </pre></div>
<div><pre>
sdkmanager --list --verbose | grep -A 3 build-tools\;
</pre></div>
</div></div>

<p>and locate the latest version. At the moment of writing this is 26.0.1, so the command to use in this case is</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ </pre></div>
<div><pre>
sdkmanager "build-tools;26.0.1"
</pre></div>
</div></div>

<h2 id="android-emulator">
<a id="android-emulator" class="anchor" href="#android-emulator" aria-hidden="true"><span class="octicon octicon-link"></span></a>Android Emulator</h2>

<p>The installation of the Android Emulator package is not mandatory, as you can decide to test your application on an actual Android device. However, there are many reasons why you might want to use an emulator: you probably don’t own a huge variety of Android devices, differing not only in physical size, but also in the API version (Kit Kat, Lollipop, Marshmallow, just to name a few of the most recent code-names). The package can be installed through the <code class="highlighter-rouge">sdkmanger</code> with the command</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ </pre></div>
<div><pre>
sdkmanager "emulator"
</pre></div>
</div></div>

<p>Again, we can add the emulator folder to the <code class="highlighter-rouge">PATH</code> variable for easy access. However, the Android SDK Tools provides a deprecated set of tools, <code class="highlighter-rouge">emulator</code> and <code class="highlighter-rouge">emulator-check</code>, that would collide with the ones we have just installed. To solve this problem we can rename the deprecated executables with</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ 
$ 
$ 
$ </pre></div>
<div><pre>
chmod -x $ANDROID_HOME/tools/emulator
chmod -x $ANDROID_HOME/tools/emulator-check
mv $ANDROID_HOME/tools/emulator $ANDROID_HOME/tools/emulator.dep
mv $ANDROID_HOME/tools/emulator-check $ANDROID_HOME/tools/emulator-check.dep
</pre></div>
</div></div>

<p>and then add the others to the <code class="highlighter-rouge">PATH</code> variables by appending the following lines to the <code class="highlighter-rouge">~/.bashrc</code> file</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell"><span class="c"># Android Emulator</span>
<span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:<span class="nv">$ANDROID_HOME</span>/emulator</code></pre></figure>

<h2 id="gradle">
<a id="gradle" class="anchor" href="#gradle" aria-hidden="true"><span class="octicon octicon-link"></span></a>Gradle</h2>

<p>Let’s now proceed to the installation of Gradle, a build automation system that is also the default in Android Studio. Google has developed a dedicated Android plugin to assist with the most common tasks. The ones that I personally tend to run more frequently are collected in the following table</p>

<table>
  <thead>
    <tr>
      <th><strong>Task</strong></th>
      <th><strong>Description</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="highlighter-rouge">compileDebugJavaWithJavac</code></td>
      <td>Compiles the debug version of the java sources. Useful to check for syntax errors while coding</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">installDebug </code></td>
      <td>Compiles and installs the debug version on all the devices discovered by the ADB.</td>
    </tr>
    <tr>
      <td><code class="highlighter-rouge">lint</code></td>
      <td>Runs a lint on the sources, producing a report in <code class="highlighter-rouge">build/reports</code>.</td>
    </tr>
  </tbody>
</table>

<p>Gradle is quite popular so it should be available from your distro’s official repositories. On Ubuntu 17.04 though, a quite old version of Gradle is available from them, so I would recommend that you add <a href="https://launchpad.net/~cwchien/+archive/ubuntu/gradle">Cheng-Wei Chien’s  PPA</a> to your software sources and install Gradle from there</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ 
$ </pre></div>
<div><pre>
sudo add-apt-repository ppa:cwchien/gradle
sudo apt update &amp;&amp; sudo apt install gradle
</pre></div>
</div></div>

<p>Gradle is quite a powerful tool, but you might find that it has a rather steep learning curve to master all of its features, especially if you are not familiar with Groovy. In this post we shall only scratch the very surface and look at only the closures that we need for this project, as a discussion on Gradle surely deserves a dedicated post on its own.</p>

<p>Getting back on business, the installation of Gradle was the last step that we needed to perform in order to set up the development environment, and we can now move on to creating an Android project from scratch.</p>

<h1 id="creating-the-gradle-project">
<a id="creating-the-gradle-project" class="anchor" href="#creating-the-gradle-project" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating the Gradle Project</h1>

<p>The first thing to do is to create a Gradle project of Java type. This involves setting up a directory structure in the project’s parent folder and creating the Gradle build script <code class="highlighter-rouge">build.gradle</code>. With Gradle installed, these steps can be automated with the <a href="https://docs.gradle.org/current/userguide/build_init_plugin.html"><code class="highlighter-rouge">init</code></a> task</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ </pre></div>
<div><pre>
gradle init --type java-library
</pre></div>
</div></div>

<p>If you are contributing to a project that is the work of many hands, it will probably be the case that everybody is using the same build tools. As everybody can have a different version of Gradle on their local machine, the Gradle project recommends that one uses a <a href="https://docs.gradle.org/current/userguide/gradle_wrapper.html">wrapper</a> to build a project, rather than invoke the local installation of Gradle directly. By sharing the wrapper along with your project, every other developer working on the same project will be able to use the same version of Gradle as everybody else, thus getting rid of problems caused by switching between different versions. Even though this is a sample project, we will nonetheless create and use a Gradle wrapper to build our project. The previous command should have created a <code class="highlighter-rouge">gradlew</code> shell script in the project’s folder. If not, run the following command</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ </pre></div>
<div><pre>
gradle wrapper
</pre></div>
</div></div>

<p>You should also have a folder <code class="highlighter-rouge">src/</code> containing all the sub-folders where Gradle expects the sources and the resources that make up your project. But, most importantly, you should also have the <code class="highlighter-rouge">build.gradle</code> and <code class="highlighter-rouge">settings.gradle</code> files containing some sample build settings. This structure is slightly different from the one generated by Android Studio, and documented on the <a href="https://developer.android.com/studio/build/index.html">developer portal</a>, where you can notice a nested Gradle project, with the topmost one used to import the actual project as a module, and configure the global build settings. For the case at hand, we could to without this nested structure and only define a single build script, since our project is made up of only one module.</p>

<p>The following is the content of the <code class="highlighter-rouge">build.gradle</code> file.</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="n">buildscript</span> <span class="o">{</span>
    <span class="n">repositories</span> <span class="o">{</span>
        <span class="n">jcenter</span><span class="o">()</span>
    <span class="o">}</span>
    <span class="n">dependencies</span> <span class="o">{</span>
        <span class="n">classpath</span> <span class="s1">'com.android.tools.build:gradle:2.3.3'</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="n">apply</span> <span class="nl">plugin:</span> <span class="s1">'com.android.application'</span>

<span class="n">android</span> <span class="o">{</span>
    <span class="n">compileSdkVersion</span> <span class="mi">23</span>
    <span class="n">buildToolsVersion</span> <span class="s1">'26.0.1'</span>
<span class="o">}</span></code></pre></figure>

<p>You can find a detailed explanation of the meaning of each closure in the <a href="https://developer.android.com/studio/build/index.html#top-level">Configure Your Build</a> page of the Android Developer portal. Briefly, the <code class="highlighter-rouge">buildscript</code> closure is used to configure Gradle itself so that it knows where to find the Android-specific Gradle tools that we want to use. We can then import the Android Gradle plugin and use the extensions to the DSL that it provides to configure the Android-specific build process. In this case we specify that the compilation SDK version that we want to use is Level 23 (Marshmallow), and that we want to use the version <code class="highlighter-rouge">26.0.1</code> of the build tools.</p>

<p>The <code class="highlighter-rouge">gradle.properties</code> file is used to configure the project-wide Gradle settings, such as the Gradle daemon’s maximum heap size. In fact, this is all we will use it for in our case. Open it with your text editor and put the following content in it</p>

<figure class="highlight"><pre><code class="language-groovy" data-lang="groovy"><span class="n">org</span><span class="o">.</span><span class="na">gradle</span><span class="o">.</span><span class="na">jvmargs</span><span class="o">=-</span><span class="n">Xmx1536m</span></code></pre></figure>

<p>This is our Gradle project created and configured! All the magic of the building process is hidden from us by the Android Gradle plugin so that we don’t have to worry about anything else and just focus on our application code.</p>

<h1 id="writing-the-application">
<a id="writing-the-application" class="anchor" href="#writing-the-application" aria-hidden="true"><span class="octicon octicon-link"></span></a>Writing the Application</h1>

<p>Two essential ingredients for an Android application are the <strong>Main Activity</strong> and the <a href="https://developer.android.com/guide/topics/manifest/manifest-intro.html"><strong>App Manifest</strong></a>. Let’s start with the latter first.</p>

<h2 id="the-application-manifest">
<a id="the-application-manifest" class="anchor" href="#the-application-manifest" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Application Manifest</h2>

<p>The Android Application Manifest is an XML manifest file that is used to provide the Android system with essential information of an application, like the name of the Java package, the activities provided, the permissions required, the minimum SDK version supported etc… . Within a Gradle project, this file must be located in the <code class="highlighter-rouge">src/main</code> folder and named rigorously <code class="highlighter-rouge">AndroidManifest.xml</code>. In our case, this is what such manifest file would look like</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;manifest</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
  <span class="na">package=</span><span class="s">"com.p403n1x87.androtest"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;uses-sdk</span>
    <span class="na">android:minSdkVersion=</span><span class="s">"21"</span>
    <span class="na">android:targetSdkVersion=</span><span class="s">"23"</span> <span class="nt">/&gt;</span>

  <span class="nt">&lt;application</span>
    <span class="na">android:label=</span><span class="s">"AndroTest"</span>
    <span class="na">android:theme=</span><span class="s">"@android:style/Theme.Material"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;activity</span> <span class="na">android:name=</span><span class="s">"MainActivity"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;intent-filter&gt;</span>
        <span class="nt">&lt;action</span> <span class="na">android:name=</span><span class="s">"android.intent.action.MAIN"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;category</span> <span class="na">android:name=</span><span class="s">"android.intent.category.LAUNCHER"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/intent-filter&gt;</span>
    <span class="nt">&lt;/activity&gt;</span>
  <span class="nt">&lt;/application&gt;</span>
<span class="nt">&lt;/manifest&gt;</span></code></pre></figure>

<p>The structure of the Android Application Manifest file is described <a href="https://developer.android.com/guide/topics/manifest/manifest-intro.html#filestruct">on the developer portal</a> in the form of a skeleton, as it is not based on any XML schema like DTD or XSD.</p>

<p>The root element is <code class="highlighter-rouge">manifest</code>, which accepts the <code class="highlighter-rouge">package</code> attribute. Here we specify the name of the Java package of our application. We also specify our target API level to 23. The minimum level supported is set to 21 for reasons that relate to the output of the <code class="highlighter-rouge">lint</code> Android Gradle task that we will look at later on. It is recommended that you set this attribute to a reasonable value. For example, if you do not set it, Android will automatically add the legacy overflow <em>three-dot</em> button, even though there are no actions to show. Starting from level 11, Android does not add this button by default.</p>

<p>The <code class="highlighter-rouge">manifest</code> element must contain a unique <code class="highlighter-rouge">application</code> element that describes our application in may aspects, from the theme to use, to the activity content. In this case we set the application name to <code class="highlighter-rouge">AndroTest</code> and the theme to <code class="highlighter-rouge">Material</code> and we expose only one activity, i.e. the <code class="highlighter-rouge">MainActivity</code>, which is the entry point of our application, and the one that would be fired up when we launch it.</p>

<h2 id="the-main-activity">
<a id="the-main-activity" class="anchor" href="#the-main-activity" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Main Activity</h2>

<p>This takes us now to the main activity, i.e. the Java class that contains the code to be executed when our application is launched. Within a Gradle project, the main Java code should reside in the <code class="highlighter-rouge">src/main/java</code> folder. Since the package name is <code class="highlighter-rouge">com.p403n1x87.androtest</code>, the <code class="highlighter-rouge">MainActivity.java</code> source file should be created within the <code class="highlighter-rouge">src/main/java/com/p403n1x87/androtest</code> folder. Here is the code</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
</pre></td>
<td class="code"><pre><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">p403n1x87</span><span class="o">.</span><span class="na">androtest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.app.Activity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.os.Bundle</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.content.Context</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.hardware.Sensor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.hardware.SensorEvent</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.hardware.SensorEventListener</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.hardware.SensorManager</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.view.ViewGroup.LayoutParams</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">android.widget.TextView</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">android.widget.LinearLayout</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">static</span> <span class="n">java</span><span class="o">.</span><span class="na">lang</span><span class="o">.</span><span class="na">Math</span><span class="o">.</span><span class="na">sqrt</span><span class="o">;</span>


<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MainActivity</span> <span class="kd">extends</span> <span class="n">Activity</span>
<span class="o">{</span>
  <span class="kd">private</span> <span class="n">SensorManager</span> <span class="n">mSensorManager</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">Sensor</span>        <span class="n">mSensor</span><span class="o">;</span>

  <span class="kd">private</span> <span class="n">TextView</span>      <span class="n">text</span>       <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
  <span class="kd">private</span> <span class="n">LinearLayout</span>  <span class="n">layoutMain</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">(</span><span class="n">Bundle</span> <span class="n">savedInstanceState</span><span class="o">)</span> <span class="o">{</span>
    <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">(</span><span class="n">savedInstanceState</span><span class="o">);</span>

    <span class="c1">// UI</span>
    <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">main_layout</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">text</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span>       <span class="n">text</span>       <span class="o">=</span> <span class="o">(</span><span class="n">TextView</span><span class="o">)</span>     <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">text</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">layoutMain</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="n">layoutMain</span> <span class="o">=</span> <span class="o">(</span><span class="n">LinearLayout</span><span class="o">)</span> <span class="n">findViewById</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">id</span><span class="o">.</span><span class="na">layout_main</span><span class="o">);</span>

    <span class="c1">// Sensors</span>
    <span class="n">mSensorManager</span> <span class="o">=</span> <span class="o">(</span><span class="n">SensorManager</span><span class="o">)</span> <span class="n">getSystemService</span><span class="o">(</span><span class="n">Context</span><span class="o">.</span><span class="na">SENSOR_SERVICE</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">mSensorManager</span><span class="o">.</span><span class="na">getDefaultSensor</span><span class="o">(</span><span class="n">Sensor</span><span class="o">.</span><span class="na">TYPE_GRAVITY</span><span class="o">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
      <span class="n">List</span><span class="o">&lt;</span><span class="n">Sensor</span><span class="o">&gt;</span> <span class="n">gravSensors</span> <span class="o">=</span> <span class="n">mSensorManager</span><span class="o">.</span><span class="na">getSensorList</span><span class="o">(</span><span class="n">Sensor</span><span class="o">.</span><span class="na">TYPE_GRAVITY</span><span class="o">);</span>
      <span class="kt">int</span> <span class="n">nSensors</span> <span class="o">=</span> <span class="n">gravSensors</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
      <span class="n">text</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">"Detected gravity sensors: "</span> <span class="o">+</span> <span class="n">Integer</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">nSensors</span><span class="o">));</span>

      <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nSensors</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">TextView</span> <span class="n">tvSensor</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TextView</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
        <span class="kd">final</span> <span class="kt">int</span>      <span class="n">j</span>        <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>

        <span class="n">tvSensor</span><span class="o">.</span><span class="na">setLayoutParams</span><span class="o">(</span><span class="k">new</span> <span class="n">LayoutParams</span><span class="o">(</span><span class="n">LayoutParams</span><span class="o">.</span><span class="na">WRAP_CONTENT</span><span class="o">,</span> <span class="n">LayoutParams</span><span class="o">.</span><span class="na">WRAP_CONTENT</span><span class="o">));</span>

        <span class="n">mSensor</span> <span class="o">=</span> <span class="n">gravSensors</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
        <span class="n">mSensorManager</span><span class="o">.</span><span class="na">registerListener</span><span class="o">(</span><span class="k">new</span> <span class="n">SensorEventListener</span><span class="o">()</span> <span class="o">{</span>
          <span class="nd">@Override</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onSensorChanged</span><span class="o">(</span><span class="kd">final</span> <span class="n">SensorEvent</span> <span class="n">event</span><span class="o">)</span> <span class="o">{</span>
    		    <span class="kt">float</span> <span class="n">x</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">values</span><span class="o">[</span><span class="mi">0</span><span class="o">];</span>
    		    <span class="kt">float</span> <span class="n">y</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">values</span><span class="o">[</span><span class="mi">1</span><span class="o">];</span>
    		    <span class="kt">float</span> <span class="n">z</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="na">values</span><span class="o">[</span><span class="mi">2</span><span class="o">];</span>
    		    <span class="kt">float</span> <span class="n">g</span> <span class="o">=</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span> <span class="n">sqrt</span><span class="o">(</span><span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="n">y</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="n">z</span><span class="o">*</span><span class="n">z</span><span class="o">);</span>

            <span class="n">tvSensor</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"Sensor %d: %f m/s^2"</span><span class="o">,</span> <span class="n">j</span><span class="o">,</span> <span class="n">g</span><span class="o">));</span>
          <span class="o">}</span>

          <span class="nd">@Override</span>
          <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onAccuracyChanged</span><span class="o">(</span><span class="n">Sensor</span> <span class="n">sensor</span><span class="o">,</span> <span class="kt">int</span> <span class="n">a</span><span class="o">)</span> <span class="o">{}</span>
        <span class="o">},</span> <span class="n">mSensor</span><span class="o">,</span> <span class="n">SensorManager</span><span class="o">.</span><span class="na">SENSOR_DELAY_NORMAL</span><span class="o">);</span>

        <span class="n">layoutMain</span><span class="o">.</span><span class="na">addView</span><span class="o">(</span><span class="n">tvSensor</span><span class="o">);</span>
      <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">else</span> <span class="o">{</span>
      <span class="n">text</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="s">"We DO NOT have gravity! :("</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>

<span class="o">}</span></pre></td>
</tr></tbody></table></code></pre></figure>

<p>The code is fairly simple and quite self-explanatory. We override the <code class="highlighter-rouge">onCreate</code> method of the <code class="highlighter-rouge">Activity</code> class, from which <code class="highlighter-rouge">MainActivity</code> inherits, to set up the UI. We use a layout resource as a basis, which we then dynamically extend with extra <code class="highlighter-rouge">TextView</code> widgets to hold the value of each gravity sensor that gets discovered at run-time.</p>

<h2 id="the-layout-resource">
<a id="the-layout-resource" class="anchor" href="#the-layout-resource" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Layout Resource</h2>

<p>In this project we have a mixture of static layout resources and dynamic creation of <code class="highlighter-rouge">TextView</code> elements. This offers us the chance to see how to make resources available to the Java code, i.e. by placing them in the place where Gradle, and the Android Gradle plugin, would expect them. Files placed in the <code class="highlighter-rouge">src/main/res</code> folder are treated as resources and can be referenced in the way described at the Android Developer portal. In the previous code block, on line 36 we have</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">    <span class="n">setContentView</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">layout</span><span class="o">.</span><span class="na">main_layout</span><span class="o">);</span></code></pre></figure>

<p>The expression <code class="highlighter-rouge">R.layout.main_layout</code> refers to the resource <code class="highlighter-rouge">main_layout.xml</code> located in the <code class="highlighter-rouge">layout</code> sub-folder of <code class="highlighter-rouge">src/main/res</code>. The various grouping of resources is detailed at the page <a href="https://developer.android.com/guide/topics/resources/providing-resources.html">Providing Resources</a>.</p>

<p>Later on, in dealing with the output of the <code class="highlighter-rouge">lint</code> task, we will have the chance to look at the <code class="highlighter-rouge">strings.xml</code> resources in the <code class="highlighter-rouge">values</code> sub-folder. For the time being, let’s have a look at what the <code class="highlighter-rouge">main_layout.xml</code> looks like in this case:</p>

<figure class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;LinearLayout</span> <span class="na">xmlns:android=</span><span class="s">"http://schemas.android.com/apk/res/android"</span>
              <span class="na">android:id=</span><span class="s">"@+id/layout_main"</span>
              <span class="na">android:layout_width=</span><span class="s">"match_parent"</span>
              <span class="na">android:layout_height=</span><span class="s">"match_parent"</span>
              <span class="na">android:padding=</span><span class="s">"32px"</span>
              <span class="na">android:gravity=</span><span class="s">"center"</span>
              <span class="na">android:orientation=</span><span class="s">"vertical"</span> <span class="nt">&gt;</span>

  <span class="nt">&lt;TextView</span> <span class="na">android:id=</span><span class="s">"@+id/text"</span>
            <span class="na">android:layout_width=</span><span class="s">"wrap_content"</span>
            <span class="na">android:layout_height=</span><span class="s">"wrap_content"</span>
            <span class="na">android:paddingBottom=</span><span class="s">"12px"</span>
            <span class="na">android:text=</span><span class="s">"Gravity sensors"</span> <span class="nt">/&gt;</span>

  <span class="c">&lt;!--
  A new TextView element will be added programmatically for each on-board
  gravity sensor detected.
  --&gt;</span>

<span class="nt">&lt;/LinearLayout&gt;</span></code></pre></figure>

<p>This is a rather simple layout. We create a vertical <code class="highlighter-rouge">LinearLayout</code> container to display a vertical stack of <code class="highlighter-rouge">TextView</code> elements. The first one, statically included in the XML resource file, will hold the counter of the discovered gravity sensors. More <code class="highlighter-rouge">TextView</code> elements are added at run-time, one for each of the sensors, to display their updated value.</p>

<h1 id="running-the-application">
<a id="running-the-application" class="anchor" href="#running-the-application" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running the Application</h1>

<p>Now that we have set up the Gradle project and coded our application, it is time to build it and install it on an Android device to run it. In this section we shall see how to invoke the Gradle <code class="highlighter-rouge">build</code> task to generate the APK (the Android Package Kit) package, and how to install it on our devices, being them either virtual or physical, in two different ways. Finally, we will give a final touch to our sample application by fixing a few of the issue reported by the <code class="highlighter-rouge">lint</code> task.</p>

<h2 id="building-with-gradle">
<a id="building-with-gradle" class="anchor" href="#building-with-gradle" aria-hidden="true"><span class="octicon octicon-link"></span></a>Building with Gradle</h2>

<p>The process of building an Android application involves many steps and tools. If we rely on a Gradle project, as we have done in this case, and as it would be if you were using Android Studio, all of the details of this process are hidden to us. In a post where we are trying to make use of only simple tools, you may think that Gradle would defeat the point. Whilst I’d agree with you, I also believe that we will have to draw a line at some point, and Gradle feels like the right place. If, at any point, you feel the need to manually build your project, you can refer to these two references for more details:</p>

<ul>
  <li><a href="https://spin.atomicobject.com/2011/08/22/building-android-application-bundles-apks-by-hand/">Building Android Application Bundles (APKs) by Hand</a></li>
  <li><a href="http://czak.pl/2016/05/31/handbuilt-android-project.html">Jack, Jill &amp; building Android apps by hand</a></li>
</ul>

<p>This being said, let’s see how to build our sample project with Gradle. We can list all the available tasks with</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ </pre></div>
<div><pre>
./gradlew tasks --all
</pre></div>
</div></div>

<p>Among all the tasks listed by the previous command, we should see the following ones</p>

<div class="terminal"><div class="terminal-body flex-container flex-row"><div><pre>
Build tasks
-----------
assemble - Assembles all variants of all applications and secondary packages.
assembleAndroidTest - Assembles all the Test applications.
assembleDebug - Assembles all Debug builds.
assembleRelease - Assembles all Release builds.
build - Assembles and tests this project.
buildDependents - Assembles and tests this project and all projects that depend on it.
buildNeeded - Assembles and tests this project and all projects it depends on.
clean - Deletes the build directory.
cleanBuildCache - Deletes the build cache directory.
compileDebugAndroidTestSources
compileDebugSources
compileDebugUnitTestSources
compileReleaseSources
compileReleaseUnitTestSources
mockableAndroidJar - Creates a version of android.jar that's suitable for unit tests.
</pre></div></div></div>

<p>We could decide to <code class="highlighter-rouge">assemble</code> our project, or <code class="highlighter-rouge">build</code> it in case we also wrote tests and want them built too. As it doesn’t make much of a difference in our case, we can run the <code class="highlighter-rouge">build</code> task with</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ </pre></div>
<div><pre>
./gradlew build
</pre></div>
</div></div>

<blockquote>
  <p>The <code class="highlighter-rouge">build</code> task actually does a bit more than assemble and execute tests. It also runs the <code class="highlighter-rouge">lint</code> task. More on this later.</p>
</blockquote>

<p>If the build task was successful, you should now have the <code class="highlighter-rouge">androtest-debug.apk</code> into the <code class="highlighter-rouge">build/outputs/apk</code> folder, ready to be deployed on an Android device.</p>

<h2 id="creating-a-virtual-device">
<a id="creating-a-virtual-device" class="anchor" href="#creating-a-virtual-device" aria-hidden="true"><span class="octicon octicon-link"></span></a>Creating a Virtual Device</h2>

<p>In case you want to install the application on a physical device, you can skip this section and go straight to the next one. Under some circumstances, you might want to test your application on diverse hardware settings, and the best way is probably to make use of a <em>virtual device</em>. If you have installed the <code class="highlighter-rouge">emulator</code> package as previously described, you can create a virtual machine with the following commands. But first we need to install a <em>system image</em>, for example the <strong>Intel x86 Atom_64 System Image</strong>. Since our application doesn’t make use of the Google APIs we can opt for the default image:</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ </pre></div>
<div><pre>
sdkmanager "system-images;android-23;default;x86_64"
</pre></div>
</div></div>

<p>The download and installation might take some time, so just wait for <code class="highlighter-rouge">sdkmanager</code> to complete. You can then proceed to creating a virtual device with</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ </pre></div>
<div><pre>
avdmanager create avd -n test -k "system-images;android-23;default;x86_64" -d 8
</pre></div>
</div></div>

<p>This will create a virtual device named <code class="highlighter-rouge">test</code> with the system image that we have just downloaded. The <code class="highlighter-rouge">-d</code> switch specifies which device we want to emulate. In this case the value 8 represents a “Nexus 5” device. A complete list of the devices that can be emulated may be found with</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ </pre></div>
<div><pre>
avdmanager list device
</pre></div>
</div></div>

<p>Finally, to run the newly created virtual device we use the <code class="highlighter-rouge">emulator</code> tool, just like this:</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ </pre></div>
<div><pre>
emulator @test -skin 768x1280
</pre></div>
</div></div>

<p>where <code class="highlighter-rouge">@test</code> specified the name of the virtual device we want to run, and the <code class="highlighter-rouge">-skin</code> switch defines the resolution we want to run the emulator at. Note that a bug in the <code class="highlighter-rouge">emulator</code> tools prevents you from running this command from any working directory. Instead, you need to navigate to <code class="highlighter-rouge">$ANDROID_HOME/emulator</code> in order to start it without errors.</p>

<p>For more details on how to manage virtual devices, have a look at the <a href="https://developer.android.com/studio/command-line/avdmanager.html#global_options"><code class="highlighter-rouge">avdmanager</code></a> documentation page.</p>

<h2 id="installing-the-apk">
<a id="installing-the-apk" class="anchor" href="#installing-the-apk" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installing the APK</h2>

<p>There are at least to ways of installing the APK to an Android device. One is via a Gradle task, and the other is more manual and involves the Android Debug Bridge tool <code class="highlighter-rouge">adb</code>. Let’s have a look at both.</p>

<p>From the previous run of the <code class="highlighter-rouge">./gradlew tasks --all</code>, you should have seen the following tasks</p>

<div class="terminal"><div class="terminal-body flex-container flex-row"><div><pre>
Install tasks
-------------
installDebug - Installs the Debug build.
installDebugAndroidTest - Installs the android (on device) tests for the Debug build.
uninstallAll - Uninstall all applications.
uninstallDebug - Uninstalls the Debug build.
uninstallDebugAndroidTest - Uninstalls the android (on device) tests for the Debug build.
uninstallRelease - Uninstalls the Release build.
</pre></div></div></div>

<p>The <code class="highlighter-rouge">installDebug</code> task will look for all the Android devices in debugging mode connected to your machine and attempt to install the APK on <em>all</em> of them. For instance, if you have a physical device in debug mode connected to your PC/laptop while also running a virtual device, this Gradle task will install the APK on both of them.</p>

<p>If you want to install the APK on only one of the currently connected devices, you can do so with the <code class="highlighter-rouge">adb</code> tool. First of all, determine the identifier of each of the connected devices with</p>

<div class="terminal"><div class="terminal-body flex-container flex-row"><div><pre>
$ adb devices
List of devices attached
* daemon not running. starting it now at tcp:5037 *
* daemon started successfully *
05426e2409d30434	device
emulator-5554	device
</pre></div></div></div>

<p>The device with ID <code class="highlighter-rouge">05426e2409d30434</code> is a physical Nexus 5 in debug mode connected via USB to my laptop, while <code class="highlighter-rouge">emulator-5554</code>, as the name indicates, is a running instance of the <code class="highlighter-rouge">test</code> virtual device we created before. We can install the APK on e.g. the emulator with</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ </pre></div>
<div><pre>
adb -s "emulator-5554" install build/outputs/apk/androtest-debug.apk
</pre></div>
</div></div>

<p>which will now be ready to be executed on the virtual device.</p>

<h2 id="the-lint-tasks">
<a id="the-lint-tasks" class="anchor" href="#the-lint-tasks" aria-hidden="true"><span class="octicon octicon-link"></span></a>The lint tasks</h2>

<p>If you have ever used Android Studio you might wonder if there is the chance to get all the useful code analysis and hints that the IDE brings up while you code your application. While this feature is probably not supported by the text editor of your choice, we can remedy by using the lint tool provided by the Android SDK. A convenient way to invoke it is through a dedicated Gradle task. From the output of <code class="highlighter-rouge">./gradlew tasks --all</code> you should also see the following tasks</p>

<div class="terminal"><div class="terminal-body flex-container flex-row"><div><pre>
Verification tasks
------------------
check - Runs all checks.
connectedAndroidTest - Installs and runs instrumentation tests for all flavors on connected devices.
connectedCheck - Runs all device checks on currently connected devices.
connectedDebugAndroidTest - Installs and runs the tests for debug on connected devices.
deviceAndroidTest - Installs and runs instrumentation tests using all Device Providers.
deviceCheck - Runs all device checks using Device Providers and Test Servers.
lint - Runs lint on all variants.
lintDebug - Runs lint on the Debug build.
lintRelease - Runs lint on the Release build.
test - Run unit tests for all variants.
testDebugUnitTest - Run unit tests for the debug build.
testReleaseUnitTest - Run unit tests for the release build.
</pre></div></div></div>

<p>Notice how we can invoke the lint tool in multiple ways. As we saw before, the <code class="highlighter-rouge">build</code> task, as opposed to <code class="highlighter-rouge">assemble</code>, will also run the lint tool. But we can also choose to run it as part of a full check with the <code class="highlighter-rouge">check</code> task, or just on its own, on every variant of our project or simply on the debug build. As an example, let’s run the <code class="highlighter-rouge">lint</code> task with</p>

<div class="terminal"><div class="terminal-body flex-container flex-row">
<div class="pad-right"><pre>$ </pre></div>
<div><pre>
./gradlew lint
</pre></div>
</div></div>

<p>The output should contain something that looks like the following</p>

<div class="terminal"><div class="terminal-body flex-container flex-row"><div><pre>
...
&gt; Task :lint
Ran lint on variant debug: 13 issues found
Ran lint on variant release: 13 issues found
Wrote HTML report to file:///home/gabriele/Projects/androtest/build/reports/lint-results.html
Wrote XML report to file:///home/gabriele/Projects/androtest/build/reports/lint-results.xml


BUILD SUCCESSFUL in 1s
25 actionable tasks: 7 executed, 18 up-to-date
</pre></div></div></div>

<p>This tells us that the lint tool has found 13 issues on both the debug and the release build of our project, and that a report is available as both an HTML and an XML file in <code class="highlighter-rouge">build/reports</code>.</p>

<p>Let’s open the HTML report and have a look at the reported issues. As predictable, the largest number of issues is about <em>internationalisation</em>, as we have used many hard-coded strings in our source code. So let’s try to fix some of these, starting from the <code class="highlighter-rouge">HardcodedText</code> one. By clicking on it, we get sent to a more detailed part of the page that suggests us to use a <code class="highlighter-rouge">@string</code> resource instead of the hard-coded string <code class="highlighter-rouge">Gravity sensors</code>. Since our code will change the string at run-time in any case, the simplest solution is to replace it with an empty string. If we now run the lint task again, we should see only 12 issues. Good! :).</p>

<p>Let’s now tackle a couple of <em>TextView Internationalization</em> issues. The first one is about the string <code class="highlighter-rouge">"Detected gravity sensors: " + Integer.toString(nSensors)</code> that we have used in the <code class="highlighter-rouge">MainActivity.java</code> source file. The problem here is two-fold. We should use a resource string and favour placeholders rather than concatenation. So let’s create a <a href="https://developer.android.com/guide/topics/resources/string-resource.html">string resource</a> file. Recall from before that this should go in an XML file, say <code class="highlighter-rouge">strings.xml</code>, within the <code class="highlighter-rouge">src/main/res/values</code> folder.</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="cp">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="nt">&lt;resources&gt;</span>
    <span class="nt">&lt;string</span> <span class="na">name=</span><span class="s">"sensors_no"</span><span class="nt">&gt;</span>Detected gravity sensors: %d<span class="nt">&lt;/string&gt;</span>
<span class="nt">&lt;/resources&gt;</span></code></pre></figure>

<p>We can now replace line 44 in <code class="highlighter-rouge">MainActivity.java</code> with</p>

<figure class="highlight"><pre><code class="language-java" data-lang="java">      <span class="n">text</span><span class="o">.</span><span class="na">setText</span><span class="o">(</span><span class="n">getString</span><span class="o">(</span><span class="n">R</span><span class="o">.</span><span class="na">string</span><span class="o">.</span><span class="na">sensors_no</span><span class="o">,</span> <span class="n">nSensors</span><span class="o">));</span></code></pre></figure>

<p>Run the lint task again, and the count should now be down to only 9 issues. This should give you the idea of how to continue fixing the remaining findings.</p>

<h1 id="conclusions">
<a id="conclusions" class="anchor" href="#conclusions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Conclusions</h1>

<p>In this post we saw that, if we want to develop Android applications by simply relying on a text editor and some command line tools, the initial set up of the development environment requires a few preliminary steps, some of which are performed when you install Android Studio. However, some of the other steps need to be performed regardless, with the only difference that, in Android Studio, you would have a GUI to assist you. The bonus of going IDE-free, however, is in the fact that we now know what operations are being performed by the IDE when, e.g., we install an Android SDK that targets a certain API level.</p>

<p>Creating a Gradle project is quite easy, and in this we are assisted by Gradle itself. The Android Gradle plugin takes care of invoking the right tools to perform the most common tasks, like building our project, or even installing it on an Android device. One handy feature that we might miss out with a plain text editor is the live linting of our code. However, at any stage of the development, we can run the <code class="highlighter-rouge">lint</code> Gradle task to generate a report with all the issues that have been discovered within the whole project.</p>

<p>This post should have also showed you that, whilst Android Studio is a very useful tool, there is practically nothing that we would miss out by using the command line tools of the SDK instead. Development might at first be less smooth, and the learning curve steeper, but surely has its positives too.</p>

    </div>

    <div class="comments">
  <h1>Comments</h1>

  
    
    
    <ul class="comment-list">
      
        
        
          
          <li>
            <div class="comment-container">
              <img src="https://www.gravatar.com/avatar/" class="gravatar"/>
              <div class="comment">
                <div class="comment-info">
                  <i class="fa fa-pencil" aria-hidden="true"></i> <span>op</span> <i class="fa fa-calendar" aria-hidden="true"></i> <span>Wed, Jan 24, 2018 @ 05:28</span>
                </div>
                <div class="comment-text"><p>Very useful.</p>
</div>
                <div>
                  <span class="action" onclick="reply('op', 1516771681)">REPLY</span>
                </div>
                


  

  




              </div>
            </div>
          </li>
        
      
    </ul>
  

  <h2 id="comment-hdr">Leave a comment</h2>
  <script src="https://p403n1x87.github.io//js/comments.js"></script>

<form id     = "post-comment"
      class  = "comment"
      method = "post"
      action = "">

  <input type        = "text"
         name        = "fields[name]"
         id          = "name"
         placeholder = "Name"/>

  <input type        = "text"
         name        = "fields[email]"
         placeholder = "E-mail address (optional; stored hashed for privacy)"/>

  <textarea name        = "fields[comment]"
            id          = "comment"
            rows        = "5"
            placeholder = "Write your comment here. You can use markdown and LaTeX (use $...$ to inline)"></textarea>

  <button type  = "button"
          class = "flat_button"
          id    = "btn-submit-comment"
          onClick="submitComment();">
    SUBMIT FOR APPROVAL
  </button>


  <!-- Hidden fields -->

   <input type  = "hidden"
          name  = "fields[pic]"
          value = "android-dev"/>

    <input type  = "hidden"
           id    = "timestamp"
           name  = "fields[timestamp]"
           value = "1557091937"/>

    <input type  = "hidden"
           id    = "parent"
           name  = "fields[parent]"
           value = "0"/>

</form>

<div id="snackbar"></div>


</div>

  </div>
</article>

      </div>
    </div>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">The Hub of Heliopolis</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>The Hub of Heliopolis is maintained by Gabriele N. Tornetta</li>
          <li><a href="mailto:phoenix1987@gmail.com">phoenix1987@gmail.com</a></li>
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <i class="fa fa-github" aria-hidden="true"></i>&nbsp;<a href="https://github.com/P403n1x87"><span class="username">P403n1x87</span></a>

          </li>
          

          

          <li>
            <i class="fa fa-rss-square" aria-hidden="true"></i>&nbsp;<a href="/feed.xml">Subscribe</a>
          </li>
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>The Hub of Heliopolis is the <i>tech bay</i> of <a href="http://thenestofheliopolis.blogspot.co.uk/">The Nest of Heliopolis</a>. It is the home of all my <i>encounters</i> with technology that I consider worth sharing with the World.
</p>
      </div>
    </div>

    <div class="footer-copyright">
      Copyright (C) 2017 Gabriele N. Tornetta. All rights reserved.
    </div>

  </div>

</footer>


    
      <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-104560783-1', 'auto');
  ga('send', 'pageview');

</script>

    

    <script src="https://use.fontawesome.com/8c7b940d60.js"></script>

    <!-- MathJax support -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>


  </body>

</html>
